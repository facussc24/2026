<!-- SVG Definitions -->
<svg style="position: absolute; width: 0; height: 0; overflow: hidden;" aria-hidden="true">
  <defs>
    <marker id="arrowhead" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
      <polygon points="0 0, 10 5, 0 10" fill="#4f46e5"></polygon>
    </marker>
    <marker id="arrowhead-warning" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
      <polygon points="0 0, 10 5, 0 10" fill="var(--accent-red)"></polygon>
    </marker>
  </defs>
</svg>

<div class="flex h-screen flex-col">
  <!-- HEADER superior -->
  <header class="p-3 sm:p-4 border-b border-border-light flex items-center justify-between bg-header-light shrink-0 z-30 shadow-sm">
    <div class="flex items-center gap-3">
      <h1 class="text-xl sm:text-2xl font-semibold text-gray-800">Planning</h1>
      <span id="rangeLabel" class="text-sm text-gray-500"></span>
    </div>
    <div class="flex items-center gap-3 sm:gap-4">
      <div class="hidden sm:flex items-center gap-2">
        <button id="btnAnnual" class="px-2 sm:px-3 py-1 text-xs sm:text-sm rounded-md bg-white text-gray-700 shadow">Anual</button>
        <button id="btnMonthly" class="px-2 sm:px-3 py-1 text-xs sm:text-sm rounded-md text-gray-600 hover:bg-white">Mensual</button>
      </div>
      <div class="flex items-center gap-2">
        <label class="text-xs text-gray-500">Zoom</label>
        <input id="zoomRange" type="range" min="10" max="50" step="1" value="18" class="w-32" />
      </div>
      <button id="btnGoToday" class="px-2 sm:px-3 py-1 text-xs sm:text-sm rounded-md bg-white text-gray-700 shadow border border-border-light">Hoy</button>
      <div id="monthlyNav" class="hidden sm:flex items-center gap-1">
        <button id="btnPrevMonth" title="Mes anterior" class="p-1 rounded-md hover:bg-gray-100 text-gray-600">&lt;</button>
        <select id="monthPicker" class="rounded-md border-border-light text-sm"></select>
        <button id="btnNextMonth" title="Mes siguiente" class="p-1 rounded-md hover:bg-gray-100 text-gray-600">&gt;</button>
      </div>
      <button class="hidden sm:inline-flex px-3 sm:px-4 py-2 bg-primary-color text-white rounded-lg hover:bg-blue-700 transition-colors">Export</button>
    </div>
  </header>
  <div class="flex-1 overflow-hidden timeline-grid">
    <!-- LEFT: LISTA DE TAREAS -->
    <aside class="sticky left-0 z-20 bg-task-bg-light border-r border-border-light flex flex-col">
      <div class="flex items-center justify-between p-3 sm:p-4 h-[72px] border-b border-border-light shrink-0">
        <h2 class="text-lg font-semibold text-gray-800">Tareas</h2>
        <div class="flex items-center gap-2">
           <button id="addTaskBtn" class="px-3 py-1 text-xs rounded-md bg-white text-gray-700 shadow border border-border-light">Tarea +</button>
           <button id="addMilestoneBtn" class="px-3 py-1 text-xs rounded-md bg-white text-gray-700 shadow border border-border-light">Fecha clave +</button>
        </div>
      </div>
      <div id="taskList" class="space-y-2 p-3 sm:p-4 overflow-y-auto"></div>
    </aside>
    <!-- RIGHT: TIMELINE -->
    <section class="col-start-2 row-start-1 overflow-hidden flex flex-col">
      <div class="sticky top-0 z-10 bg-header-light shadow-sm border-b border-border-light select-none">
        <!-- Headers... -->
        <div id="yearsViewport" class="overflow-hidden"><div id="yearsTrack" class="flex text-center text-sm font-semibold text-gray-700 will-change-transform"></div></div>
        <div id="monthsViewport" class="overflow-hidden border-t border-border-light"><div id="monthsTrack" class="flex text-center text-[12px] sm:text-sm text-gray-600 will-change-transform"></div></div>
        <div id="weeksViewport" class="overflow-hidden border-t border-border-light can-drag"><div id="weeksTrack" class="flex text-center text-[11px] sm:text-xs text-gray-600 will-change-transform"></div></div>
        <div id="daysViewport" class="overflow-hidden border-t border-border-light can-drag"><div id="daysTrack" class="grid text-gray-400 will-change-transform"></div></div>
      </div>
      <div id="timelineScroll" class="flex-1 overflow-auto can-drag bg-white"></div>
    </section>
  </div>
</div>

<!-- Modal -->
<div id="modal-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden opacity-0">
    <div id="modal-box" class="bg-white rounded-lg shadow-xl w-full max-w-md p-6 transform scale-95">
        <h3 id="modal-title" class="text-lg font-medium leading-6 text-gray-900 mb-4"></h3>
        <div id="modal-content" class="space-y-4"></div>
        <div id="modal-actions" class="mt-6 flex justify-end space-x-3">
            <button id="modal-cancel-btn" class="px-4 py-2 bg-white border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">Cancelar</button>
            <button id="modal-ok-btn" class="px-4 py-2 bg-primary-color border border-transparent rounded-md text-sm font-medium text-white hover:bg-blue-700">Aceptar</button>
        </div>
    </div>
</div>

<!-- AI Assistant Button -->
<button id="ai-assistant-button" class="fixed bottom-6 right-6 bg-blue-600 text-white p-4 rounded-full shadow-lg hover:bg-blue-700 transition-transform transform hover:scale-110 z-50">
    <i data-lucide="sparkles" class="w-8 h-8"></i>
</button>
