<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Hotspots de Vehículo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        #hotspot-container {
            position: relative;
            width: 100%;
            max-width: 1200px;
            margin: auto;
        }

        #hotspot-container img {
            display: block;
            width: 100%;
            height: auto;
        }

        #hotspot-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .hotspot-polygon {
            fill: rgba(29, 78, 216, 0.3); /* blue-700 with 30% opacity */
            stroke: rgba(59, 130, 246, 0.9); /* blue-500 */
            stroke-width: 2;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }

        .hotspot-polygon:hover {
            fill: rgba(29, 78, 216, 0.5); /* blue-700 with 50% opacity */
        }

        .hotspot-polygon.active {
            fill: rgba(239, 68, 68, 0.5); /* red-500 with 50% opacity */
            stroke: rgba(239, 68, 68, 0.9); /* red-500 */
        }

        #side-panel {
            transition: transform 0.3s ease-in-out;
            transform: translateX(100%);
        }

        #side-panel.open {
            transform: translateX(0);
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="flex h-screen overflow-hidden">
        <!-- Main content -->
        <main class="flex-1 flex items-center justify-center p-4">
            <div id="hotspot-container">
                <img id="vehicle-image" src="/Maxus.jpg" alt="Imagen del vehículo">
                <svg id="hotspot-svg" preserveAspectRatio="none"></svg>
            </div>
        </main>

        <!-- Side Panel -->
        <aside id="side-panel" class="w-96 bg-white shadow-lg p-6 fixed top-0 right-0 h-full">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-gray-800">Detalles de la Pieza</h2>
                <button id="close-panel-btn" class="text-gray-500 hover:text-gray-800">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <div id="panel-content">
                <!-- Content will be injected here -->
            </div>
        </aside>
    </div>

    <script>
    // IIFE to encapsulate the module
    (function() {
        document.addEventListener('DOMContentLoaded', () => {
            const vehicleImage = document.getElementById('vehicle-image');
            const hotspotSvg = document.getElementById('hotspot-svg');
            const sidePanel = document.getElementById('side-panel');
            const panelContent = document.getElementById('panel-content');
            const closePanelBtn = document.getElementById('close-panel-btn');

            // --- Hotspot Data ---
            // using normalized coordinates (0 to 1)
            const hotspots = [
                {
                    id: 'apoyacabezas',
                    name: 'Apoyacabezas',
                    partNumber: 'V-102-3C',
                    description: 'Apoyacabezas de cuero sintético, ajustable en altura y ángulo.',
                    imageUrl: 'https://via.placeholder.com/300x200.png?text=Apoyacabezas',
                    points: [
                        { x: 0.496, y: 0.222 },
                        { x: 0.560, y: 0.246 },
                        { x: 0.538, y: 0.334 },
                        { x: 0.478, y: 0.304 }
                    ]
                },
                {
                    id: 'apoyabrazos',
                    name: 'Apoyabrazos Central',
                    partNumber: 'V-105-1A',
                    description: 'Consola de apoyabrazos central con compartimento de almacenamiento.',
                    imageUrl: 'https://via.placeholder.com/300x200.png?text=Apoyabrazos',
                    points: [
                        { x: 0.458, y: 0.505 },
                        { x: 0.528, y: 0.508 },
                        { x: 0.530, y: 0.558 },
                        { x: 0.459, y: 0.556 }
                    ]
                }
            ];

            function drawHotspots() {
                const imageWidth = vehicleImage.width;
                const imageHeight = vehicleImage.height;

                if (imageWidth === 0 || imageHeight === 0) return;

                hotspotSvg.innerHTML = ''; // Clear previous hotspots

                hotspots.forEach(hotspot => {
                    const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');

                    const pointsStr = hotspot.points
                        .map(p => `${p.x * imageWidth},${p.y * imageHeight}`)
                        .join(' ');

                    polygon.setAttribute('points', pointsStr);
                    polygon.setAttribute('class', 'hotspot-polygon');
                    polygon.dataset.id = hotspot.id;

                    hotspotSvg.appendChild(polygon);
                });
            }

            function openPanel(hotspot) {
                // Highlight active hotspot
                document.querySelectorAll('.hotspot-polygon').forEach(p => {
                    p.classList.remove('active');
                });
                document.querySelector(`.hotspot-polygon[data-id="${hotspot.id}"]`).classList.add('active');

                // Populate and show panel
                panelContent.innerHTML = `
                    <img src="${hotspot.imageUrl}" alt="${hotspot.name}" class="w-full h-48 object-cover rounded-lg mb-4">
                    <h3 class="text-xl font-bold text-gray-900">${hotspot.name}</h3>
                    <p class="text-sm text-gray-500 mb-2">N/P: ${hotspot.partNumber}</p>
                    <p class="text-gray-700">${hotspot.description}</p>
                `;
                sidePanel.classList.add('open');
            }

            function closePanel() {
                sidePanel.classList.remove('open');
                document.querySelectorAll('.hotspot-polygon').forEach(p => {
                    p.classList.remove('active');
                });
            }

            // --- Event Listeners ---
            hotspotSvg.addEventListener('click', (e) => {
                if (e.target.classList.contains('hotspot-polygon')) {
                    const hotspotId = e.target.dataset.id;
                    const hotspotData = hotspots.find(h => h.id === hotspotId);
                    if (hotspotData) {
                        openPanel(hotspotData);
                    }
                }
            });

            closePanelBtn.addEventListener('click', closePanel);

            // --- Initialization ---
            function init() {
                if (vehicleImage.complete) {
                    drawHotspots();
                } else {
                    vehicleImage.onload = drawHotspots;
                }
            }

            window.addEventListener('resize', drawHotspots);

            init();
        });
    })();
    </script>
</body>
</html>
