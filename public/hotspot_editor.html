<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Hotspots de Vehículo</title>

    <!-- Bootstrap for styling -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- jQuery UI for draggable/resizable -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="hotspot_editor.css">
</head>
<body>

    <div class="container mt-5">
        <div class="card">
            <div class="card-header bg-dark text-white">
                <h1 class="card-title mb-0">Editor de Zonas Interactivas (Hotspots)</h1>
                <p class="card-subtitle mt-1">Haga clic en "Añadir Nueva Zona" para empezar a crear hotspots en la imagen.</p>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- Columna del Editor de Imagen -->
                    <div class="col-lg-8">
                        <h4 class="mb-3">Lienzo de Edición</h4>
                        <div class="imagemaps-wrapper shadow-sm">
                            <img src="Maxus.jpg" draggable="false" class="img-fluid">
                        </div>
                    </div>

                    <!-- Columna de Controles -->
                    <div class="col-lg-4">
                        <h4 class="mb-3">Panel de Control</h4>
                        <div class="imagemaps-control">
                            <fieldset>
                                <legend class="h6">Configuración de Zonas</legend>
                                <div class="table-responsive">
                                    <table class="table table-hover table-sm">
                                        <thead>
                                            <tr>
                                                <th scope="col">#</th>
                                                <th scope="col">Título / Enlace</th>
                                                <th scope="col">Acción</th>
                                            </tr>
                                        </thead>
                                        <tbody class="imagemaps-output">
                                            <!-- Template for new rows -->
                                            <tr class="item-###" style="display: none;">
                                                <th scope="row">###</th>
                                                <td><input type="text" class="form-control form-control-sm area-href" placeholder="Ej: Capó, Puerta..."></td>
                                                <td><button type="button" class="btn btn-danger btn-sm btn-delete">Eliminar</button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </fieldset>
                            <div class="mt-3">
                                <button type="button" class="btn btn-info btn-add-map">Añadir Nueva Zona</button>
                                <button type="button" class="btn btn-success btn-get-map">Obtener Código HTML</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <p class="mb-0"><strong>Instrucciones:</strong></p>
                <ol class="mb-0 pl-3">
                    <li>Haz clic en "Añadir Nueva Zona". Aparecerá un cuadrado semitransparente sobre la imagen.</li>
                    <li>Arrastra el cuadrado a la posición deseada.</li>
                    <li>Redimensiona el cuadrado desde sus esquinas para que cubra la pieza del vehículo.</li>
                    <li>En el "Panel de Control", asigna un título o enlace a la zona que acabas de crear.</li>
                    <li>Repite el proceso para todas las zonas que quieras añadir.</li>
                    <li>Al finalizar, haz clic en "Obtener Código HTML" para ver el código `<map>` generado.</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- jQuery and jQuery UI -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <!-- The plugin -->
    <script src="jquery.imagemaps.js"></script>

    <script>
        $(document).ready(function() {
            // Initialize the image map editor
            $('.imagemaps-wrapper').imageMaps({
                addBtn: '.btn-add-map',
                output: '.imagemaps-output',
                stopCallBack: function(active, coords) {
                    console.log('Active area:', active);
                    console.log('Coordinates:', coords);
                }
            });

            // Handle the "Get Code" button
            $('.btn-get-map').on('click', function() {
                let oParent = $(this).closest('.imagemaps-control').parent().parent();
                let result = oParent.find('.imagemaps-wrapper').clone();

                // Clean up the result for display
                result.find('div[id^=imagemaps-rect]').remove(); // Remove the draggable divs
                let generatedCode = result.html().trim();

                // Display the code in a modal
                let modalContent = `
                    <div class="modal fade" id="codeModal" tabindex="-1" role="dialog">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Código HTML Generado</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <p>Copia y pega este código en tu página de visualización:</p>
                                    <pre><code class="language-html">${escapeHtml(generatedCode)}</code></pre>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                </div>
                            </div>
                        </div>
                    </div>`;

                // Add modal to body and show it
                $('body').append(modalContent);
                $('#codeModal').modal('show');
                // Clean up the modal from the DOM after it's hidden
                $('#codeModal').on('hidden.bs.modal', function () {
                    $(this).remove();
                });
            });

            function escapeHtml(unsafe) {
                return unsafe
                     .replace(/&/g, "&amp;")
                     .replace(/</g, "&lt;")
                     .replace(/>/g, "&gt;")
                     .replace(/"/g, "&quot;")
                     .replace(/'/g, "&#039;");
             }
        });
    </script>
    <!-- Bootstrap JS for modal functionality -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
