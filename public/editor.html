<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Hotspots de Vehículo</title>

    <!-- Bootstrap for styling from a CSP-approved CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- jQuery UI CSS from a CSP-approved CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="editor.css">
</head>
<body>

    <div class="container mt-5">
        <div class="card">
            <div class="card-header bg-dark text-white">
                <h1 class="card-title mb-0">Editor de Zonas Interactivas (Hotspots)</h1>
                <p class="card-subtitle mt-1">Haga clic en "Añadir Nueva Zona" para empezar a crear hotspots en la imagen.</p>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- Columna del Editor de Imagen -->
                    <div class="col-lg-8">
                        <h4 class="mb-3">Lienzo de Edición</h4>
                        <div class="imagemaps-wrapper shadow-sm">
                            <img src="Maxus.jpg" draggable="false" class="img-fluid">
                        </div>
                    </div>

                    <!-- Columna de Controles -->
                    <div class="col-lg-4">
                        <h4 class="mb-3">Panel de Control</h4>
                        <div class="imagemaps-control">
                            <fieldset>
                                <legend class="h6">Configuración de Zonas</legend>
                                <div class="table-responsive">
                                    <table class="table table-hover table-sm">
                                        <thead>
                                            <tr>
                                                <th scope="col">#</th>
                                                <th scope="col">Título de la Pieza</th>
                                                <th scope="col">Acción</th>
                                            </tr>
                                        </thead>
                                        <tbody class="imagemaps-output">
                                            <!-- Template for new rows -->
                                            <tr class="item-###" style="display: none;">
                                                <th scope="row">###</th>
                                                <td><input type="text" class="form-control form-control-sm area-title" placeholder="Ej: Capó, Puerta..."></td>
                                                <td><button type="button" class="btn btn-danger btn-sm btn-delete">Eliminar</button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </fieldset>
                            <div class="mt-3">
                                <button type="button" class="btn btn-info btn-add-map">Añadir Nueva Zona</button>
                                <button type="button" class="btn btn-success btn-get-map">Obtener Código HTML</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <p class="mb-0"><strong>Instrucciones:</strong></p>
                <ol class="mb-0 pl-3">
                    <li>Haz clic en "Añadir Nueva Zona". Aparecerá un cuadrado semitransparente sobre la imagen.</li>
                    <li>Arrastra el cuadrado a la posición deseada y redimensiónalo.</li>
                    <li>En el "Panel de Control", asigna un título a la zona (este título se usará en el visualizador).</li>
                    <li>Al finalizar, haz clic en "Obtener Código HTML" y copia el código `<map>...</map>` generado.</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- Modal for displaying the generated code -->
    <div class="modal fade" id="codeModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Código HTML Generado</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Copia y pega este código en la página del visualizador (`viewer.html`):</p>
                    <pre><code id="generated-code" class="language-html"></code></pre>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>


    <!-- jQuery from a CSP-approved CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- jQuery UI from a CSP-approved CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <!-- Bootstrap JS from a CSP-approved CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- The local plugin -->
    <script src="jquery.imagemaps.js"></script>

    <script>
        $(document).ready(function() {
            // Initialize the image map editor
            $('.imagemaps-wrapper').imageMaps({
                addBtn: '.btn-add-map',
                output: '.imagemaps-output',
                areaHref: '.area-title', // Use the input field to store the title
            });

            // Handle the "Get Code" button
            $('.btn-get-map').on('click', function() {
                let oParent = $(this).closest('.card-body');
                let result = oParent.find('.imagemaps-wrapper').clone();

                // Clean up the result for display
                result.find('div[id^=imagemaps-rect]').remove(); // Remove the draggable divs

                // Add title and data-part-key attributes for easier use in the viewer
                result.find('area').each(function() {
                    let title = $(this).attr('href'); // The title is stored in the href attribute by the plugin
                    let key = title.toLowerCase().replace(/\\s+/g, '-').replace(/[^a-z0-9-]/g, '');
                    $(this).attr('title', title);
                    $(this).attr('data-part-key', key);
                    $(this).attr('href', '#'); // Set a dummy href for the final code
                });

                let generatedCode = result.html().trim();

                // Display the code in a modal, pretty-printed
                $('#generated-code').text(generatedCode.replace(/><area/g, '>\n    <area'));
                $('#codeModal').modal('show');
            });
        });
    </script>
</body>
</html>
